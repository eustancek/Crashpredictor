<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Crash Prediction System</title>
    
    <!-- Preconnect to CDNs for faster loading -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- Load CSS first -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    
    <!-- Load scripts with defer attribute -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.0.1/build/global/luxon.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0/dist/chartjs-adapter-luxon.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.0/dist/chartjs-plugin-zoom.min.js" defer></script>
    
    <!-- Add Supabase client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary: #4c6ef5;
            --secondary: #8b5cf6;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #121212;
            --card-bg: #1e293b;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #e0e0e0;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .card {
            background-color: var(--card-bg);
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 20px -5px rgba(0, 0, 0, 0.25);
        }
        
        .gradient-header {
            background: linear-gradient(135deg, #4c6ef5, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 110, 245, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(76, 110, 245, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 110, 245, 0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .scroll-container {
            scrollbar-width: thin;
            scrollbar-color: #4a5568 #1a202c;
        }
        
        .scroll-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .scroll-container::-webkit-scrollbar-track {
            background: #1a202c;
        }
        
        .scroll-container::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 20px;
        }
        
        .voice-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--danger);
            margin-right: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .voice-indicator.active {
            opacity: 1;
            animation: pulse 1.5s infinite;
        }
        
        .prediction-card {
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.4s ease;
        }
        
        .prediction-card.visible {
            transform: scale(1);
            opacity: 1;
        }
        
        .speech-bubble {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--card-bg);
            color: white;
            padding: 12px 18px;
            border-radius: 20px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            max-width: 300px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }
        
        .speech-bubble.visible {
            opacity: 1;
        }
        
        .accuracy-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(var(--primary) 0%, var(--primary) var(--accuracy), var(--card-bg) var(--accuracy), var(--card-bg) 100%);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .accuracy-inner {
            width: 70px;
            height: 70px;
            background: var(--dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .risk-level {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            display: inline-block;
        }
        
        .cpu-badge {
            background: linear-gradient(135deg, #4c6ef5, #3b5bdb);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .cashout-range {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(76, 110, 245, 0.1);
            border-radius: 0.75rem;
            border: 1px solid rgba(76, 110, 245, 0.3);
        }
        
        .range-item {
            text-align: center;
            flex: 1;
        }
        
        .range-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        
        .range-label {
            font-size: 0.85rem;
            color: #a0aec0;
        }
        
        @media (max-width: 1024px) {
            .grid-cols-1-lg {
                grid-template-columns: 1fr;
            }
            
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .will-change {
            will-change: transform, opacity;
        }
        
        button:focus, input:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        .animate-transform {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
        }
        
        .delete-btn {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .delete-btn:hover {
            transform: scale(1.1);
            color: #ef4444;
        }
        
        .modal-enter {
            opacity: 0;
            transform: translateY(20px);
        }
        
        .modal-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .modal-exit {
            opacity: 1;
            transform: translateY(0);
        }
        
        .modal-exit-active {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .voice-command-hint {
            background: rgba(139, 92, 246, 0.2);
            border-left: 4px solid #8b5cf6;
            padding: 8px 12px;
            border-radius: 4px;
            margin-top: 8px;
        }
        
        .status-success {
            color: #22c55e;
        }
        
        .status-error {
            color: #ef4444;
        }
        
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #2d3748;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4c6ef5, #8b5cf6);
            transition: width 0.3s ease;
        }
        
        .batch-indicator {
            font-size: 0.8rem;
            color: #a0aec0;
            margin-top: 4px;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .connection-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .connection-connected {
            background-color: #22c55e;
        }
        
        .connection-disconnected {
            background-color: #ef4444;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <!-- Speech Bubble for Voice Feedback -->
    <div id="speechBubble" class="speech-bubble" aria-live="polite"></div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full transform transition-transform duration-300 translate-y-4">
            <h3 class="text-xl font-bold mb-4 text-white">Confirm Deletion</h3>
            <p id="deleteMessage" class="mb-6 text-gray-300">Are you sure you want to delete this multiplier?</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelDelete" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg text-white transition-colors">Cancel</button>
                <button id="confirmDelete" class="px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white transition-colors">Delete</button>
            </div>
        </div>
    </div>

    <!-- Delete All Confirmation Modal -->
    <div id="deleteAllModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-gray-800 rounded-xl p-6 max-w-md w-full transform transition-transform duration-300 translate-y-4">
            <h3 class="text-xl font-bold mb-4 text-white">Confirm Bulk Deletion</h3>
            <p class="mb-6 text-gray-300">Are you sure you want to delete all multipliers? This cannot be undone.</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelDeleteAll" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-lg text-white transition-colors">Cancel</button>
                <button id="confirmDeleteAll" class="px-4 py-2 bg-red-600 hover:bg-red-500 rounded-lg text-white transition-colors">Delete All</button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold mb-2 gradient-header">
                Advanced Crash Prediction
                <span class="cpu-badge">Unlimited Storage</span>
            </h1>
            <p class="text-gray-400 mb-6">Multiplier analysis with voice commands and unlimited cloud storage</p>
            <div class="flex flex-wrap items-center justify-center gap-2 text-sm text-gray-500">
                <span>Created by Kenitius Ngandwe</span>
                <span>•</span>
                <span id="systemStatus" class="flex items-center">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                    System Operational
                </span>
                <span>•</span>
                <span>Version 4.1.0</span>
            </div>
            <div class="mt-4 flex justify-center">
                <div class="connection-status">
                    <span class="connection-dot connection-connected" id="connectionDot"></span>
                    <span id="connectionStatus">Connected to Supabase</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 main-grid">
            <!-- Left Column - Input & Multipliers -->
            <div class="lg:col-span-1">
                <!-- Input Section -->
                <div class="card p-6 mb-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                        </svg>
                        Multiplier Management
                    </h2>
                    
                    <div class="mb-4">
                        <div class="flex space-x-2">
                            <input 
                                type="number" 
                                id="multiplierInput" 
                                class="flex-1 bg-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none"
                                placeholder="Enter multiplier (e.g., 1.25)"
                                step="0.01"
                                min="0.01"
                                max="100"
                                aria-label="Multiplier value"
                            >
                            <button 
                                id="addMultiplier" 
                                class="bg-blue-600 hover:bg-blue-700 text-white rounded-lg px-4 py-2 transition-colors duration-200"
                                aria-label="Add multiplier"
                            >
                                Add
                            </button>
                        </div>
                        
                        <div class="mt-4">
                            <label for="multiMultiplierInput" class="block text-sm font-medium text-gray-400 mb-2">
                                Add Multiple Multipliers (one per line):
                            </label>
                            <textarea 
                                id="multiMultiplierInput" 
                                class="w-full bg-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none resize-none h-32"
                                placeholder="1.25&#10;2.5&#10;3.0&#10;4.2&#10;5.7"
                            ></textarea>
                            <div class="flex gap-2 mt-2">
                                <button 
                                    id="addMultiMultipliers" 
                                    class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg px-4 py-2 transition-colors duration-200"
                                >
                                    Add All
                                </button>
                                <button 
                                    id="clearMultiInput" 
                                    class="flex-1 bg-gray-600 hover:bg-gray-500 text-white rounded-lg px-4 py-2 transition-colors duration-200"
                                >
                                    Clear
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-4 voice-command-hint">
                            <p class="text-sm">Say: <span class="font-mono">"multiplier 1.25"</span> or <span class="font-mono">"1.25 2.5 3.0"</span> to add multiple values</p>
                            <p class="text-sm mt-1">Say: <span class="font-mono">"delete last"</span> or <span class="font-mono">"clear all"</span></p>
                        </div>
                    </div>

                    <!-- Voice Input Controls -->
                    <div class="bg-gray-700 rounded-lg p-4 mb-4">
                        <div class="flex flex-wrap items-center justify-between mb-3">
                            <h3 class="font-medium flex items-center mb-2 md:mb-0">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-purple-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd" />
                                </svg>
                                Voice Command
                            </h3>
                            <div class="flex items-center space-x-2">
                                <div id="voiceIndicator" class="voice-indicator" aria-hidden="true"></div>
                                <button 
                                    id="toggleVoice" 
                                    class="bg-purple-600 hover:bg-purple-700 text-white rounded px-3 py-2 text-sm transition-colors duration-200"
                                    aria-label="Toggle voice recognition"
                                >
                                    Start Listening
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Multipliers List -->
                    <div class="bg-gray-700 rounded-lg p-4">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="font-medium flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.04.305.07.61.07.93a7 7 0 11-13.90.00c.00.202.01.403.03.602.17 3.055 2.56 5.397 5.61 5.53.05.002.102.003.154.003.264 0 .527-.014.789-.042 2.976-.26 5.212-2.504 5.472-5.48.028-.262.042-.525.042-.789 0-.052-.001-.104-.003-.156A6.97 6.97 0 0112.93 17z" />
                                </svg>
                                Current Multipliers (<span id="multiplierCount">0</span>)
                            </h3>
                            <div class="flex space-x-2">
                                <button 
                                    id="deleteAllMultipliers" 
                                    class="text-red-400 hover:text-red-300 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                    title="Delete all multipliers"
                                    aria-label="Delete all multipliers"
                                    disabled
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div id="multipliersContainer" class="scroll-container max-h-60 overflow-y-auto pr-2">
                            <div class="text-center text-gray-500 py-4" id="noMultipliersMessage">
                                No multipliers added yet
                            </div>
                        </div>
                        
                        <div class="flex gap-2 mt-4 pt-4 border-t border-gray-600">
                            <button 
                                id="supabaseSave" 
                                class="flex-1 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                disabled
                                aria-label="Save to Supabase"
                            >
                                Save to Cloud
                            </button>
                            <button 
                                id="generatePrediction" 
                                class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                disabled
                                aria-label="Generate prediction"
                            >
                                Predict
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Cloud Status -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                        Unlimited Cloud Storage
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="flex items-center">
                            <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                            <div>
                                <div class="font-medium">Multiplier Storage</div>
                                <div class="text-sm text-gray-400">Store unlimited multipliers in the cloud</div>
                            </div>
                        </div>
                        
                        <div class="flex gap-2">
                            <button 
                                id="loadFromCloud" 
                                class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors duration-200 disabled:opacity-50"
                                aria-label="Load from cloud"
                            >
                                Load
                            </button>
                            <button 
                                id="supabaseDelete" 
                                class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg transition-colors duration-200 disabled:opacity-50"
                                aria-label="Delete from cloud"
                            >
                                Delete
                            </button>
                        </div>
                        
                        <div class="mt-4 pt-4 border-t border-gray-600">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-gray-400">Last saved:</span>
                                <span id="lastSaved" class="text-sm font-medium">Never</span>
                            </div>
                            <div class="flex justify-between items-center mt-2">
                                <span class="text-sm text-gray-400">Multipliers in cloud:</span>
                                <span id="cloudCount" class="text-sm font-medium">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Single Multiplier Save Form -->
                <div class="card p-6 mt-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                        </svg>
                        Save Multiplier to Cloud
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="flex space-x-2">
                            <input 
                                type="number" 
                                id="multiplier-value" 
                                class="flex-1 bg-gray-700 text-white rounded-lg px-4 py-2 focus:outline-none"
                                placeholder="Enter multiplier (e.g., 1.25)"
                                step="0.01"
                                min="0.01"
                                max="100"
                                aria-label="Multiplier value"
                            >
                            <button 
                                id="save-btn" 
                                class="bg-green-600 hover:bg-green-700 text-white rounded-lg px-4 py-2 transition-colors duration-200"
                                aria-label="Save multiplier"
                            >
                                Save
                            </button>
                        </div>
                        
                        <div id="output" class="text-sm text-center py-2 rounded"></div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Prediction & Analytics -->
            <div class="lg:col-span-2">
                <!-- Accuracy & System Status -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- Accuracy Display -->
                    <div class="bg-gradient-to-br from-blue-900 to-indigo-900 rounded-xl p-5 shadow-lg">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-400 text-sm">Prediction Accuracy</p>
                                <div class="mt-2">
                                    <div class="text-2xl font-bold" id="accuracyDisplay">75.00%</div>
                                    <div class="text-xs text-gray-300 mt-1">Current model performance</div>
                                </div>
                            </div>
                            <div class="accuracy-circle" id="accuracyCircle">
                                <div class="accuracy-inner" id="accuracyValue">75%</div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="text-xs text-gray-400 mb-1">Confidence Level</div>
                            <div class="w-full bg-gray-700 rounded-full h-2.5">
                                <div id="confidenceMeter" class="bg-blue-500 h-2.5 rounded-full" style="width: 75%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Range Analysis -->
                    <div class="bg-gradient-to-br from-purple-900 to-pink-900 rounded-xl p-5 shadow-lg">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-400 text-sm">Prediction Range</p>
                                <div class="mt-2">
                                    <div class="text-2xl font-bold" id="rangeDisplay">±20.00%</div>
                                    <div class="text-xs text-gray-300 mt-1">Current prediction confidence</div>
                                </div>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-purple-500 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="text-xs text-gray-400 mb-1">Range Trend</div>
                            <div class="flex items-center">
                                <div class="flex-1 bg-gray-700 rounded-full h-2">
                                    <div id="rangeTrendBar" class="bg-purple-500 h-2 rounded-full" style="width: 65%"></div>
                                </div>
                                <span id="rangeTrendLabel" class="ml-2 text-sm">Narrowing</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Risk Level -->
                    <div class="bg-gradient-to-br from-red-900 to-orange-900 rounded-xl p-5 shadow-lg">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-gray-400 text-sm">Risk Assessment</p>
                                <div class="mt-2">
                                    <div class="text-2xl font-bold" id="riskLevel">Medium</div>
                                    <div class="text-xs text-gray-300 mt-1">Current market conditions</div>
                                </div>
                            </div>
                            <div class="w-10 h-10 rounded-full bg-red-500 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                </svg>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="text-xs text-gray-400 mb-1">Market Volatility</div>
                            <div class="w-full bg-gray-700 rounded-full h-2.5">
                                <div id="volatilityMeter" class="bg-orange-500 h-2.5 rounded-full" style="width: 45%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Prediction Results -->
                <div class="card p-6 mb-6 prediction-card" id="predictionResults">
                    <div class="flex flex-wrap justify-between items-start mb-4 gap-2">
                        <h2 class="text-xl font-semibold flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            Prediction Results
                        </h2>
                        <span id="predictionTimestamp" class="text-sm text-gray-500">Just now</span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <div class="bg-gray-700 rounded-lg p-4 mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-gray-400">Predicted Value</span>
                                    <span class="text-2xl font-bold text-blue-400" id="predictedValue">2.45</span>
                                </div>
                                <div class="w-full bg-gray-800 h-4 rounded-full mt-3 mb-2 relative">
                                    <div id="rangeLower" class="absolute top-0 h-full bg-blue-500 rounded-l-full" style="left: 15%; width: 10%"></div>
                                    <div id="rangeMiddle" class="absolute top-0 h-full bg-green-500" style="left: 25%; width: 50%"></div>
                                    <div id="rangeUpper" class="absolute top-0 h-full bg-blue-500 rounded-r-full" style="left: 75%; width: 10%"></div>
                                </div>
                                <div class="flex justify-between text-sm mt-1 text-gray-300">
                                    <span id="rangeLowerValue">1.80</span>
                                    <span id="rangeUpperValue">3.10</span>
                                </div>
                            </div>
                            
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h3 class="font-medium mb-3 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-purple-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2zm0 9a2 2 0 012-2h5a2 2 0 012 2v1a2 2 0 01-2 2H4a2 2 0 01-2-2v-1z" />
                                    </svg>
                                    Confidence Analysis
                                </h3>
                                
                                <div class="mb-3">
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Overall Confidence</span>
                                        <span id="confidencePercentage">75%</span>
                                    </div>
                                    <div class="w-full bg-gray-800 rounded-full h-2.5">
                                        <div id="confidenceBar" class="bg-purple-500 h-2.5 rounded-full" style="width: 75%"></div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="bg-gray-800 p-3 rounded">
                                        <div class="text-xs text-gray-400 mb-1">Bayesian Inference</div>
                                        <div class="font-medium" id="bayesianConfidence">78%</div>
                                    </div>
                                    <div class="bg-gray-800 p-3 rounded">
                                        <div class="text-xs text-gray-400 mb-1">Trend Strength</div>
                                        <div class="font-medium" id="trendConfidence">72%</div>
                                    </div>
                                    <div class="bg-gray-800 p-3 rounded">
                                        <div class="text-xs text-gray-400 mb-1">Volatility Regime</div>
                                        <div class="font-medium" id="volatilityConfidence">65%</div>
                                    </div>
                                    <div class="bg-gray-800 p-3 rounded">
                                        <div class="text-xs text-gray-400 mb-1">Mean Reversion</div>
                                        <div class="font-medium" id="meanReversionConfidence">82%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <div class="bg-gray-700 rounded-lg p-4 mb-4">
                                <h3 class="font-medium mb-3 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                    </svg>
                                    Risk Assessment
                                </h3>
                                
                                <div class="mb-4">
                                    <div class="text-sm font-medium mb-1">Risk Level</div>
                                    <div class="risk-level bg-yellow-900 text-yellow-200" id="riskDisplay">Medium</div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-sm font-medium mb-1">Market Regime</div>
                                    <div class="bg-gray-800 p-2 rounded text-center" id="marketRegime">Volatile Trending</div>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="text-sm font-medium mb-1">Spike Detection</div>
                                    <div class="flex items-center">
                                        <span id="spikeStatus" class="inline-block w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                                        <span id="spikeMessage">No significant spikes detected</span>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <div class="text-sm font-medium mb-1">Volatility Index</div>
                                    <div class="w-full bg-gray-800 rounded-full h-2.5">
                                        <div id="volatilityBar" class="bg-orange-500 h-2.5 rounded-full" style="width: 45%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Cash Out Range Display -->
                            <div class="cashout-range mb-4">
                                <div class="range-item">
                                    <div class="range-value text-blue-400" id="cashoutMin">1.80x</div>
                                    <div class="range-label">Min Cashout</div>
                                </div>
                                <div class="range-item">
                                    <div class="range-value text-green-400" id="cashoutRecommended">2.45x</div>
                                    <div class="range-label">Recommended</div>
                                </div>
                                <div class="range-item">
                                    <div class="range-value text-blue-400" id="cashoutMax">3.10x</div>
                                    <div class="range-label">Max Cashout</div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-700 rounded-lg p-4">
                                <h3 class="font-medium mb-3 flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1H8a3 3 0 00-3 3v1.5a1.5 1.5 0 01-3 0V6z" clip-rule="evenodd" />
                                        <path d="M6 12a2 2 0 100-4 2 2 0 000 4zm10 0a2 2 0 100-4 2 2 0 000 4zM8 16a2 2 0 100-4 2 2 0 000 4z" />
                                    </svg>
                                    Prediction Timeline
                                </h3>
                                <div class="h-40">
                                    <canvas id="predictionTimeline"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Analytics -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="card p-6">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V6a1 1 0 100-2H3zm11 4a1 1 0 100 2h-2a1 1 0 100 2h2a1 1 0 100-2h-2a1 1 0 100 2h2a1 1 0 100-2h-2z" clip-rule="evenodd" />
                            </svg>
                            Accuracy Trend
                        </h2>
                        <div class="h-64">
                            <canvas id="accuracyChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card p-6">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-purple-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V6a1 1 0 100-2H3zm11 4a1 1 0 100 2h-2a1 1 0 100 2h2a1 1 0 100-2h-2a1 1 0 100 2h2a1 1 0 100-2h-2z" clip-rule="evenodd" />
                            </svg>
                            Range Evolution
                        </h2>
                        <div class="h-64">
                            <canvas id="rangeChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Pattern Analysis -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM4 5a1 1 0 011-1h10a1 1 0 011 1v8a1 1 0 01-1 1H5a1 1 0 01-1-1V5z" clip-rule="evenodd" />
                        </svg>
                        Advanced Pattern Analysis
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 rounded-full bg-blue-900 flex items-center justify-center mr-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="text-sm font-medium">Trend Strength</div>
                                    <div class="text-xs text-gray-400">Current market direction</div>
                                </div>
                            </div>
                            <div class="h-24">
                                <canvas id="trendChart"></canvas>
                            </div>
                            <div class="mt-2 text-center font-medium" id="trendStrength">Strong Upward</div>
                        </div>
                        
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 rounded-full bg-purple-900 flex items-center justify-center mr-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-purple-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="text-sm font-medium">Volatility</div>
                                    <div class="text-xs text-gray-400">Market uncertainty level</div>
                                </div>
                            </div>
                            <div class="h-24">
                                <canvas id="volatilityChart"></canvas>
                            </div>
                            <div class="mt-2 text-center font-medium" id="volatilityLevel">Moderate</div>
                        </div>
                        
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 rounded-full bg-yellow-900 flex items-center justify-center mr-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="text-sm font-medium">Mean Reversion</div>
                                    <div class="text-xs text-gray-400">Return to average tendency</div>
                                </div>
                            </div>
                            <div class="h-24">
                                <canvas id="reversionChart"></canvas>
                            </div>
                            <div class="mt-2 text-center font-medium" id="reversionStrength">High Probability</div>
                        </div>
                        
                        <div class="bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 rounded-full bg-red-900 flex items-center justify-center mr-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-red-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                <div>
                                    <div class="text-sm font-medium">Market Regime</div>
                                    <div class="text-xs text-gray-400">Current market condition</div>
                                </div>
                            </div>
                            <div class="h-24">
                                <canvas id="regimeChart"></canvas>
                            </div>
                            <div class="mt-2 text-center font-medium" id="marketRegimeDetail">Volatile Trending</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Crash Prediction System with Unlimited Supabase Storage
        (function() {
            // Global variables
            let multipliers = [];
            let accuracy = 75.0;
            let multiplierRange = 20.0;
            let speechRecognition = null;
            let isListening = false;
            let accuracyHistory = [];
            let rangeHistory = [];
            let lastPredictionTime = null;
            let accuracyChart = null;
            let rangeChart = null;
            let trendChart = null;
            let volatilityChart = null;
            let reversionChart = null;
            let regimeChart = null;
            let predictionTimelineChart = null;
            let currentModelVersion = 0;
            let trainingHistory = [];
            
            // Supabase Configuration
            const SUPABASEURL = 'https://fawcuwcqfwzvdoalcocx.supabase.co';
            const SUPABASEKEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZhd2N1d2NxZnd6dmRvYWxjb2N4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4NDY3MjYsImV4cCI6MjA2NjQyMjcyNn0.5NCGUTGpPm7w2Jv0GURMKmGh-EQ7WztNLs9MD5_nSjc';
            const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            
            // DOM Elements
            const multiplierInput = document.getElementById('multiplierInput');
            const multiMultiplierInput = document.getElementById('multiMultiplierInput');
            const addMultiplierBtn = document.getElementById('addMultiplier');
            const addMultiMultipliersBtn = document.getElementById('addMultiMultipliers');
            const clearMultiInputBtn = document.getElementById('clearMultiInput');
            const generatePredictionBtn = document.getElementById('generatePrediction');
            const deleteAllMultipliersBtn = document.getElementById('deleteAllMultipliers');
            const multipliersContainer = document.getElementById('multipliersContainer');
            const multiplierCount = document.getElementById('multiplierCount');
            const noMultipliersMessage = document.getElementById('noMultipliersMessage');
            const supabaseSaveBtn = document.getElementById('supabaseSave');
            const supabaseDeleteBtn = document.getElementById('supabaseDelete');
            const loadFromCloudBtn = document.getElementById('loadFromCloud');
            const toggleVoiceBtn = document.getElementById('toggleVoice');
            const voiceIndicator = document.getElementById('voiceIndicator');
            const predictionResults = document.getElementById('predictionResults');
            const systemStatus = document.getElementById('systemStatus');
            const deleteModal = document.getElementById('deleteModal');
            const deleteAllModal = document.getElementById('deleteAllModal');
            const cancelDelete = document.getElementById('cancelDelete');
            const confirmDelete = document.getElementById('confirmDelete');
            const cancelDeleteAll = document.getElementById('cancelDeleteAll');
            const confirmDeleteAll = document.getElementById('confirmDeleteAll');
            const deleteMessage = document.getElementById('deleteMessage');
            const speechBubble = document.getElementById('speechBubble');
            const lastSavedElement = document.getElementById('lastSaved');
            const cloudCountElement = document.getElementById('cloudCount');
            const connectionStatus = document.getElementById('connectionStatus');
            const connectionDot = document.getElementById('connectionDot');
            
            // New form elements
            const multiplierValueInput = document.getElementById('multiplier-value');
            const saveBtn = document.getElementById('save-btn');
            const outputDiv = document.getElementById('output');
            
            // Initialize the application
            document.addEventListener('DOMContentLoaded', function() {
                // Load saved data from localStorage
                loadFromLocalStorage();
                
                // Setup event listeners
                setupEventListeners();
                
                // Initialize charts
                initCharts();
                
                // Check system status
                checkSystemStatus();
                
                // Load model metadata
                loadModelMetadata();
                
                // Setup speech recognition if available
                setupSpeechRecognition();
                
                // Update UI
                updateMultipliersDisplay();
                updateAccuracyDisplay();
                updateRangeDisplay();
                
                // Update last saved time
                updateLastSavedTime();
                
                // Load cloud count
                fetchCloudMultiplierCount();
                
                // Test Supabase connection
                testSupabaseConnection();
            });
            
            // Test Supabase connection
            async function testSupabaseConnection() {
                try {
                    const { data, error } = await supabase
                        .from('multipliers')
                        .select('*', { count: 'exact', head: true });
                    
                    if (error) throw error;
                    
                    connectionStatus.textContent = "Connected to Supabase";
                    connectionDot.className = "connection-dot connection-connected";
                } catch (error) {
                    console.error('Supabase connection error:', error);
                    connectionStatus.textContent = "Supabase connection failed";
                    connectionDot.className = "connection-dot connection-disconnected";
                }
            }
            
            // Fetch multiplier count from Supabase
            async function fetchCloudMultiplierCount() {
                try {
                    const { count, error } = await supabase
                        .from('multipliers')
                        .select('*', { count: 'exact', head: true });
                    
                    if (error) throw error;
                    
                    cloudCountElement.textContent = count || 0;
                } catch (error) {
                    console.error('Error fetching multiplier count:', error);
                    cloudCountElement.textContent = 'Error';
                }
            }
            
            // Load saved data from localStorage
            function loadFromLocalStorage() {
                try {
                    const savedMultipliers = localStorage.getItem('crashPredictor_multipliers');
                    if (savedMultipliers) {
                        multipliers = JSON.parse(savedMultipliers);
                    }
                    
                    const savedAccuracyHistory = localStorage.getItem('crashPredictor_accuracyHistory');
                    if (savedAccuracyHistory) {
                        accuracyHistory = JSON.parse(savedAccuracyHistory);
                    }
                    
                    const savedRangeHistory = localStorage.getItem('crashPredictor_rangeHistory');
                    if (savedRangeHistory) {
                        rangeHistory = JSON.parse(savedRangeHistory);
                    }
                    
                    const savedTrainingHistory = localStorage.getItem('crashPredictor_trainingHistory');
                    if (savedTrainingHistory) {
                        trainingHistory = JSON.parse(savedTrainingHistory);
                    }
                } catch (e) {
                    console.error('Error loading from localStorage:', e);
                    showSpeechBubble('Error loading saved data');
                }
            }
            
            // Save data to localStorage
            function saveToLocalStorage() {
                try {
                    localStorage.setItem('crashPredictor_multipliers', JSON.stringify(multipliers));
                    localStorage.setItem('crashPredictor_accuracyHistory', JSON.stringify(accuracyHistory));
                    localStorage.setItem('crashPredictor_rangeHistory', JSON.stringify(rangeHistory));
                    localStorage.setItem('crashPredictor_trainingHistory', JSON.stringify(trainingHistory));
                } catch (e) {
                    console.error('Error saving to localStorage:', e);
                    showSpeechBubble('Error saving data');
                }
            }
            
            // Update last saved time display
            function updateLastSavedTime() {
                const lastSaved = localStorage.getItem('crashPredictor_lastSaved');
                if (lastSaved) {
                    lastSavedElement.textContent = new Date(parseInt(lastSaved)).toLocaleString();
                } else {
                    lastSavedElement.textContent = 'Never';
                }
            }
            
            // Setup event listeners
            function setupEventListeners() {
                // Add multiplier button
                addMultiplierBtn.addEventListener('click', addMultiplier);
                
                // Add multiple multipliers button
                addMultiMultipliersBtn.addEventListener('click', addMultipleMultipliers);
                
                // Clear multi-input button
                clearMultiInputBtn.addEventListener('click', function() {
                    multiMultiplierInput.value = '';
                    multiMultiplierInput.focus();
                });
                
                // Clear all multipliers button
                deleteAllMultipliersBtn.addEventListener('click', function() {
                    if (multipliers.length === 0) return;
                    showModal(deleteAllModal);
                });
                
                // Enter key in multiplier input
                multiplierInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addMultiplier();
                    }
                });
                
                // Generate prediction button
                generatePredictionBtn.addEventListener('click', generatePrediction);
                
                // Save to Supabase button
                supabaseSaveBtn.addEventListener('click', saveMultipliersToSupabase);
                
                // Delete from Supabase button
                supabaseDeleteBtn.addEventListener('click', deleteMultipliersFromSupabase);
                
                // Load from cloud button
                loadFromCloudBtn.addEventListener('click', loadMultipliersFromSupabase);
                
                // Voice toggle button
                toggleVoiceBtn.addEventListener('click', toggleVoiceRecognition);
                
                // Modal buttons
                cancelDelete.addEventListener('click', function() {
                    hideModal(deleteModal);
                });
                
                confirmDelete.addEventListener('click', function() {
                    const index = parseInt(deleteModal.getAttribute('data-index'));
                    if (!isNaN(index)) {
                        deleteMultiplier(index);
                    }
                    hideModal(deleteModal);
                });
                
                cancelDeleteAll.addEventListener('click', function() {
                    hideModal(deleteAllModal);
                });
                
                confirmDeleteAll.addEventListener('click', function() {
                    multipliers = [];
                    updateMultipliersDisplay();
                    saveToLocalStorage();
                    generatePredictionBtn.disabled = true;
                    supabaseSaveBtn.disabled = true;
                    supabaseDeleteBtn.disabled = true;
                    hideModal(deleteAllModal);
                    showSpeechBubble('All multipliers deleted');
                });
                
                // New single multiplier save button
                saveBtn.addEventListener('click', saveSingleMultiplier);
            }
            
            // Save single multiplier to Supabase
            async function saveSingleMultiplier() {
                const value = parseFloat(multiplierValueInput.value);
                if (isNaN(value) || value <= 0) {
                    outputDiv.textContent = 'Please enter a valid positive number';
                    outputDiv.className = 'status-error';
                    return;
                }
                
                outputDiv.textContent = 'Saving...';
                outputDiv.className = '';
                
                try {
                    // Insert into Supabase
                    const { data, error } = await supabase
                        .from('multipliers')
                        .insert([{ value }]);
                    
                    if (error) {
                        throw error;
                    }
                    
                    // Update last saved time
                    localStorage.setItem('crashPredictor_lastSaved', Date.now().toString());
                    updateLastSavedTime();
                    
                    // Update cloud count
                    fetchCloudMultiplierCount();
                    
                    outputDiv.textContent = 'Saved successfully!';
                    outputDiv.className = 'status-success';
                    
                    showSpeechBubble(`Multiplier ${value} saved to cloud!`);
                    multiplierValueInput.value = '';
                    
                    console.log('Single multiplier saved to Supabase:', data);
                } catch (error) {
                    console.error('Error saving to Supabase:', error);
                    outputDiv.textContent = 'Save failed! Check console for details';
                    outputDiv.className = 'status-error';
                    showSpeechBubble('Error saving to cloud. Check console.');
                }
            }
            
            // Save multipliers to Supabase in batches
            async function saveMultipliersToSupabase() {
                if (multipliers.length === 0) {
                    showSpeechBubble('No multipliers to save');
                    return;
                }
                
                // Disable the button during save
                supabaseSaveBtn.disabled = true;
                const originalText = supabaseSaveBtn.textContent;
                supabaseSaveBtn.textContent = 'Saving...';
                
                try {
                    // Create data array for batch insert
                    const multiplierData = multipliers.map(value => ({ value }));
                    
                    // Split into chunks of 500 (Supabase limit)
                    const chunkSize = 500;
                    const chunks = [];
                    for (let i = 0; i < multiplierData.length; i += chunkSize) {
                        chunks.push(multiplierData.slice(i, i + chunkSize));
                    }
                    
                    // Show saving progress
                    const progressContainer = document.createElement('div');
                    progressContainer.className = 'mt-4';
                    progressContainer.innerHTML = `
                        <div class="text-sm text-gray-400 mb-1">Saving progress:</div>
                        <div class="progress-bar">
                            <div id="saveProgress" class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div id="batchIndicator" class="batch-indicator">Batch 1 of ${chunks.length}</div>
                    `;
                    outputDiv.innerHTML = '';
                    outputDiv.appendChild(progressContainer);
                    
                    let totalSaved = 0;
                    
                    // Save each chunk
                    for (let i = 0; i < chunks.length; i++) {
                        const chunk = chunks[i];
                        
                        // Update progress
                        document.getElementById('saveProgress').style.width = `${(i / chunks.length) * 100}%`;
                        document.getElementById('batchIndicator').textContent = `Batch ${i+1} of ${chunks.length}`;
                        
                        // Insert into Supabase
                        const { error } = await supabase
                            .from('multipliers')
                            .insert(chunk);
                        
                        if (error) {
                            throw error;
                        }
                        
                        totalSaved += chunk.length;
                        
                        // Add a small delay between batches
                        await new Promise(resolve => setTimeout(resolve, 300));
                    }
                    
                    // Update last saved time
                    localStorage.setItem('crashPredictor_lastSaved', Date.now().toString());
                    updateLastSavedTime();
                    
                    // Update cloud count
                    fetchCloudMultiplierCount();
                    
                    // Complete progress
                    document.getElementById('saveProgress').style.width = '100%';
                    
                    // Show success message
                    setTimeout(() => {
                        outputDiv.textContent = `Saved ${totalSaved} multipliers to cloud!`;
                        outputDiv.className = 'status-success';
                    }, 500);
                    
                    showSpeechBubble(`${totalSaved} multipliers saved to cloud!`);
                    console.log('Saved to Supabase:', totalSaved);
                } catch (error) {
                    console.error('Error saving to Supabase:', error);
                    outputDiv.textContent = 'Error saving to cloud. Check console.';
                    outputDiv.className = 'status-error';
                    showSpeechBubble('Error saving to cloud. Check console.');
                } finally {
                    // Re-enable button
                    supabaseSaveBtn.disabled = false;
                    supabaseSaveBtn.textContent = originalText;
                }
            }
            
            // Delete multipliers from Supabase
            async function deleteMultipliersFromSupabase() {
                try {
                    // Delete all records
                    const { error } = await supabase
                        .from('multipliers')
                        .delete()
                        .neq('id', 0); // Delete all records
                    
                    if (error) {
                        throw error;
                    }
                    
                    // Update last saved time
                    localStorage.removeItem('crashPredictor_lastSaved');
                    updateLastSavedTime();
                    
                    // Update cloud count
                    fetchCloudMultiplierCount();
                    
                    showSpeechBubble('All multipliers deleted from cloud!');
                    console.log('Deleted from Supabase');
                } catch (error) {
                    console.error('Error deleting from Supabase:', error);
                    showSpeechBubble('Error deleting from cloud. Check console.');
                }
            }
            
            // Load multipliers from Supabase with pagination
            async function loadMultipliersFromSupabase() {
                try {
                    // Disable the button during load
                    loadFromCloudBtn.disabled = true;
                    const originalText = loadFromCloudBtn.textContent;
                    loadFromCloudBtn.textContent = 'Loading...';
                    
                    let allMultipliers = [];
                    let page = 0;
                    const pageSize = 1000;
                    let hasMore = true;
                    let totalLoaded = 0;
                    
                    // Show loading progress
                    outputDiv.textContent = 'Loading multipliers from cloud...';
                    outputDiv.className = '';
                    
                    while (hasMore) {
                        const { data, error } = await supabase
                            .from('multipliers')
                            .select('value')
                            .order('id', { ascending: true })
                            .range(page * pageSize, (page + 1) * pageSize - 1);
                        
                        if (error) {
                            throw error;
                        }
                        
                        if (data.length === 0) {
                            hasMore = false;
                        } else {
                            const values = data.map(item => item.value);
                            allMultipliers = allMultipliers.concat(values);
                            totalLoaded += data.length;
                            page++;
                            
                            // Update progress
                            outputDiv.textContent = `Loaded ${totalLoaded} multipliers...`;
                        }
                    }
                    
                    // Now, we have allMultipliers. We'll add them to the current multipliers (avoid duplicates)
                    for (const value of allMultipliers) {
                        if (!multipliers.includes(value)) {
                            multipliers.push(value);
                        }
                    }
                    
                    // Update UI
                    updateMultipliersDisplay();
                    saveToLocalStorage();
                    
                    outputDiv.textContent = `Loaded ${totalLoaded} multipliers from cloud!`;
                    outputDiv.className = 'status-success';
                    
                    showSpeechBubble(`Loaded ${totalLoaded} multipliers from cloud`);
                } catch (error) {
                    console.error('Error loading from Supabase:', error);
                    outputDiv.textContent = 'Error loading from cloud. Check console.';
                    outputDiv.className = 'status-error';
                    showSpeechBubble('Error loading from cloud. Check console.');
                } finally {
                    loadFromCloudBtn.disabled = false;
                    loadFromCloudBtn.textContent = originalText;
                }
            }
            
            // Show modal with animation
            function showModal(modal) {
                modal.classList.remove('opacity-0', 'pointer-events-none');
                modal.classList.add('opacity-100', 'pointer-events-auto');
                modal.querySelector('div').classList.remove('translate-y-4');
                modal.querySelector('div').classList.add('translate-y-0');
            }
            
            // Hide modal with animation
            function hideModal(modal) {
                modal.classList.remove('opacity-100', 'pointer-events-auto');
                modal.classList.add('opacity-0', 'pointer-events-none');
                modal.querySelector('div').classList.remove('translate-y-0');
                modal.querySelector('div').classList.add('translate-y-4');
            }
            
            // Initialize charts
            function initCharts() {
                // Accuracy Chart
                const accuracyCtx = document.getElementById('accuracyChart').getContext('2d');
                accuracyChart = new Chart(accuracyCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Accuracy %',
                            data: [],
                            borderColor: '#4c6ef5',
                            backgroundColor: 'rgba(76, 110, 245, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#4c6ef5',
                            pointRadius: 4,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { mode: 'index', intersect: false }
                        },
                        scales: {
                            y: {
                                min: 70,
                                max: 100,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#a0aec0' }
                            },
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#a0aec0', maxTicksLimit: 6 }
                            }
                        }
                    }
                });
                
                // Range Chart
                const rangeCtx = document.getElementById('rangeChart').getContext('2d');
                rangeChart = new Chart(rangeCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Range %',
                            data: [],
                            borderColor: '#be185d',
                            backgroundColor: 'rgba(190, 24, 93, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#be185d',
                            pointRadius: 4,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: { mode: 'index', intersect: false }
                        },
                        scales: {
                            y: {
                                min: 5,
                                max: 65,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#a0aec0' }
                            },
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#a0aec0', maxTicksLimit: 6 }
                            }
                        }
                    }
                });
                
                // Prediction Timeline Chart
                const timelineCtx = document.getElementById('predictionTimeline').getContext('2d');
                predictionTimelineChart = new Chart(timelineCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Prediction',
                            data: [],
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            pointBackgroundColor: '#8b5cf6',
                            pointRadius: 4,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#a0aec0' }
                            },
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#a0aec0', maxTicksLimit: 6 }
                            }
                        }
                    }
                });
            }
            
            // Setup speech recognition
            function setupSpeechRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    speechRecognition = new SpeechRecognition();
                    speechRecognition.continuous = true;
                    speechRecognition.interimResults = true;
                    speechRecognition.lang = 'en-US';
                    
                    speechRecognition.onstart = function() {
                        isListening = true;
                        voiceIndicator.classList.add('active');
                        toggleVoiceBtn.textContent = 'Stop Listening';
                        toggleVoiceBtn.classList.remove('bg-purple-600', 'hover:bg-purple-700');
                        toggleVoiceBtn.classList.add('bg-red-600', 'hover:bg-red-700');
                        showSpeechBubble('Listening... Say multipliers or commands');
                    };
                    
                    speechRecognition.onend = function() {
                        isListening = false;
                        voiceIndicator.classList.remove('active');
                        toggleVoiceBtn.textContent = 'Start Listening';
                        toggleVoiceBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                        toggleVoiceBtn.classList.add('bg-purple-600', 'hover:bg-purple-700');
                        
                        // Restart recognition after a short delay to maintain continuous listening
                        if (window.speechRecognitionActive) {
                            setTimeout(() => {
                                if (window.speechRecognitionActive) {
                                    speechRecognition.start();
                                }
                            }, 1000);
                        }
                    };
                    
                    speechRecognition.onresult = function(event) {
                        let transcript = '';
                        for (let i = event.resultIndex; i < event.results.length; i++) {
                            if (event.results[i].isFinal) {
                                transcript += event.results[i][0].transcript;
                            }
                        }
                        
                        if (transcript.trim() !== '') {
                            processVoiceCommand(transcript.toLowerCase());
                        }
                    };
                    
                    speechRecognition.onerror = function(event) {
                        console.error('Speech recognition error:', event.error);
                        if (event.error === 'not-allowed') {
                            showSpeechBubble('Microphone access denied. Please enable microphone permissions.');
                        }
                    };
                } else {
                    toggleVoiceBtn.disabled = true;
                    toggleVoiceBtn.textContent = 'Not Supported';
                    showSpeechBubble('Voice recognition is not supported in your browser.');
                }
            }
            
            // Toggle voice recognition
            function toggleVoiceRecognition() {
                if (!speechRecognition) {
                    showSpeechBubble('Voice recognition is not supported in your browser.');
                    return;
                }
                
                if (isListening) {
                    window.speechRecognitionActive = false;
                    speechRecognition.stop();
                } else {
                    window.speechRecognitionActive = true;
                    try {
                        speechRecognition.start();
                    } catch (e) {
                        console.error('Error starting speech recognition:', e);
                        showSpeechBubble('Error starting voice recognition. Please try again.');
                    }
                }
            }
            
            // Process voice command
            function processVoiceCommand(command) {
                console.log('Voice command:', command);
                
                // Process command
                if (command.includes('multiplier') || command.includes('number') || /\d/.test(command)) {
                    // Extract numbers from command
                    const numbers = command.match(/[\d\.]+/g) || [];
                    
                    if (numbers.length > 0) {
                        // Add each number as a multiplier
                        numbers.forEach(num => {
                            const value = parseFloat(num);
                            if (!isNaN(value) && value > 0) {
                                addMultiplierManually(value);
                            }
                        });
                        
                        if (numbers.length > 1) {
                            showSpeechBubble(`Added ${numbers.length} multipliers via voice`);
                        }
                    }
                } else if (command.includes('delete last') || command.includes('remove last')) {
                    if (multipliers.length > 0) {
                        const lastMultiplier = multipliers[multipliers.length - 1];
                        deleteMultiplier(multipliers.length - 1);
                        showSpeechBubble(`Deleted multiplier ${lastMultiplier}`);
                    } else {
                        showSpeechBubble('No multipliers to delete');
                    }
                } else if (command.includes('delete all') || command.includes('clear all')) {
                    if (multipliers.length > 0) {
                        showModal(deleteAllModal);
                        showSpeechBubble('Confirm deletion of all multipliers');
                    } else {
                        showSpeechBubble('No multipliers to delete');
                    }
                } else if (command.includes('predict')) {
                    if (multipliers.length >= 5) {
                        generatePrediction();
                        showSpeechBubble('Generating prediction...');
                    } else {
                        showSpeechBubble(`Need ${5 - multipliers.length} more multipliers for prediction`);
                    }
                } else if (command.includes('accuracy')) {
                    showSpeechBubble(`Current accuracy is ${accuracy.toFixed(2)}%`);
                } else if (command.includes('range')) {
                    showSpeechBubble(`Current prediction range is ±${multiplierRange.toFixed(2)}%`);
                } else if (command.includes('save')) {
                    saveMultipliersToSupabase();
                } else if (command.includes('load')) {
                    loadMultipliersFromSupabase();
                } else if (command.includes('done')) {
                    showCashoutRange();
                }
            }
            
            // Add multiple multipliers at once (one per line)
            function addMultipleMultipliers() {
                const input = multiMultiplierInput.value.trim();
                if (!input) {
                    showSpeechBubble('Please enter multipliers');
                    return;
                }
                
                // Split input by newlines
                const lines = input.split('\n');
                const newMultipliers = [];
                
                // Process each line
                for (const line of lines) {
                    const trimmedLine = line.trim();
                    if (!trimmedLine) continue;
                    
                    // Try to parse as a number
                    const value = parseFloat(trimmedLine);
                    if (!isNaN(value)) {
                        newMultipliers.push(value);
                    }
                }
                
                if (newMultipliers.length === 0) {
                    showSpeechBubble('No valid multipliers found');
                    return;
                }
                
                // Add to multipliers array
                multipliers = multipliers.concat(newMultipliers);
                
                // Update UI
                updateMultipliersDisplay();
                saveToLocalStorage();
                
                // Show success message
                showSpeechBubble(`Added ${newMultipliers.length} multipliers`);
                
                // Clear textarea
                multiMultiplierInput.value = '';
            }
            
            // Add multiplier manually
            function addMultiplierManually(value) {
                if (typeof value === 'string') {
                    value = parseFloat(value);
                }
                
                if (isNaN(value) || value <= 0) {
                    showSpeechBubble('Please enter a valid positive number');
                    return;
                }
                
                multipliers.push(value);
                updateMultipliersDisplay();
                saveToLocalStorage();
                
                // Enable buttons
                generatePredictionBtn.disabled = multipliers.length < 5;
                supabaseSaveBtn.disabled = multipliers.length === 0;
                supabaseDeleteBtn.disabled = multipliers.length === 0;
                deleteAllMultipliersBtn.disabled = multipliers.length === 0;
                
                // Auto-focus input and move cursor down
                setTimeout(() => {
                    multiplierInput.focus();
                    multiplierInput.value = '';
                }, 500);
            }
            
            // Add multiplier from input
            function addMultiplier() {
                const value = multiplierInput.value.trim();
                if (value === '') return;
                
                addMultiplierManually(value);
            }
            
            // Delete a specific multiplier
            function deleteMultiplier(index) {
                if (index >= 0 && index < multipliers.length) {
                    const deletedValue = multipliers[index];
                    multipliers.splice(index, 1);
                    updateMultipliersDisplay();
                    saveToLocalStorage();
                    supabaseSaveBtn.disabled = multipliers.length === 0;
                    supabaseDeleteBtn.disabled = multipliers.length === 0;
                    deleteAllMultipliersBtn.disabled = multipliers.length === 0;
                    
                    // Disable prediction button if not enough multipliers
                    generatePredictionBtn.disabled = multipliers.length < 5;
                    
                    showSpeechBubble(`Deleted multiplier: ${deletedValue}`);
                }
            }
            
            // Update multipliers display
            function updateMultipliersDisplay() {
                // Update count
                multiplierCount.textContent = multipliers.length;
                
                // Enable/disable buttons
                supabaseSaveBtn.disabled = multipliers.length === 0;
                supabaseDeleteBtn.disabled = multipliers.length === 0;
                generatePredictionBtn.disabled = multipliers.length < 5;
                deleteAllMultipliersBtn.disabled = multipliers.length === 0;
                
                // Show/hide no multipliers message
                if (multipliers.length === 0) {
                    noMultipliersMessage.style.display = 'block';
                } else {
                    noMultipliersMessage.style.display = 'none';
                }
                
                // Clear container
                multipliersContainer.innerHTML = '';
                
                // Add multipliers in reverse order (newest at top)
                for (let i = multipliers.length - 1; i >= 0; i--) {
                    const index = i;
                    const multiplier = multipliers[index];
                    
                    const multiplierItem = document.createElement('div');
                    multiplierItem.className = 'bg-gray-800 rounded p-3 mb-2 flex items-center fade-in animate-transform';
                    multiplierItem.innerHTML = `
                        <span class="flex-1 font-mono">${multiplier.toFixed(2)}</span>
                        <button class="delete-btn text-red-400 hover:text-red-300 transition-colors duration-200 ml-2" aria-label="Delete multiplier">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    `;
                    
                    // Add delete functionality
                    const deleteBtn = multiplierItem.querySelector('button');
                    deleteBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        deleteMessage.textContent = `Are you sure you want to delete multiplier ${multiplier}?`;
                        deleteModal.setAttribute('data-index', index);
                        showModal(deleteModal);
                    });
                    
                    // Add to container
                    multipliersContainer.appendChild(multiplierItem);
                }
            }
            
            // Generate prediction
            function generatePrediction() {
                if (multipliers.length < 5) {
                    showSpeechBubble(`Need ${5 - multipliers.length} more multipliers for prediction`);
                    return;
                }
                
                // Show loading state
                const originalText = generatePredictionBtn.innerHTML;
                generatePredictionBtn.disabled = true;
                generatePredictionBtn.innerHTML = '<span class="flex items-center justify-center"><svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Predicting...</span>';
                
                // Simulate API call with delay
                setTimeout(() => {
                    // Calculate prediction based on multipliers
                    const prediction = calculatePrediction(multipliers);
                    
                    // Update UI with prediction
                    updatePredictionResults(prediction);
                    
                    // Update prediction timeline chart
                    updatePredictionTimeline(prediction.predictedValue);
                    
                    // Update last prediction time
                    lastPredictionTime = new Date();
                    document.getElementById('predictionTimestamp').textContent = 'Just now';
                    
                    // Re-enable button
                    generatePredictionBtn.disabled = false;
                    generatePredictionBtn.innerHTML = originalText;
                    
                    // Show prediction results with animation
                    predictionResults.classList.add('visible');
                    
                    // Show speech bubble
                    showSpeechBubble(`Prediction generated: ${prediction.predictedValue.toFixed(2)}`);
                }, 800);
            }
            
            // Calculate prediction
            function calculatePrediction(multipliers) {
                // Calculate average of multipliers
                const recentMultipliers = multipliers.slice(-50);
                const avg = recentMultipliers.reduce((sum, val) => sum + val, 0) / recentMultipliers.length;
                
                // Add some randomness for variation
                const randomFactor = 0.95 + Math.random() * 0.1;
                let predictedValue = avg * randomFactor;
                
                // Ensure predicted value is reasonable
                predictedValue = Math.max(1.0, Math.min(10.0, predictedValue));
                
                // Calculate confidence based on accuracy
                const confidence = accuracy / 100;
                
                // Calculate range based on multiplierRange
                const rangeLower = Math.max(1.0, predictedValue * (1 - multiplierRange / 100));
                const rangeUpper = predictedValue * (1 + multiplierRange / 100);
                
                // Determine risk level
                let riskLevel = 'Low';
                if (multiplierRange > 30) {
                    riskLevel = 'High';
                } else if (multiplierRange > 15) {
                    riskLevel = 'Medium';
                }
                
                // Determine market regime
                let marketRegime = 'Stable';
                if (multiplierRange > 30 && accuracy < 80) {
                    marketRegime = 'Volatile Ranging';
                } else if (multiplierRange < 20 && accuracy > 85) {
                    marketRegime = 'Strong Trending';
                } else if (multiplierRange > 25 && accuracy > 80) {
                    marketRegime = 'Volatile Trending';
                }
                
                // Check for spikes
                const hasSpike = detectSpikes(recentMultipliers);
                
                return {
                    predictedValue: predictedValue,
                    confidence: confidence,
                    rangeLower: rangeLower,
                    rangeUpper: rangeUpper,
                    riskLevel: riskLevel,
                    marketRegime: marketRegime,
                    hasSpike: hasSpike
                };
            }
            
            // Detect spikes in data
            function detectSpikes(data) {
                const mean = data.reduce((sum, val) => sum + val, 0) / data.length;
                const squaredDiffs = data.map(val => {
                    const diff = val - mean;
                    return diff * diff;
                });
                const avgSquaredDiff = squaredDiffs.reduce((sum, val) => sum + val, 0) / data.length;
                const stdDev = Math.sqrt(avgSquaredDiff);
                
                // Check if any value is more than 3 standard deviations from mean
                return data.some(val => Math.abs(val - mean) > 3 * stdDev);
            }
            
            // Update prediction results
            function updatePredictionResults(prediction) {
                // Update predicted value
                document.getElementById('predictedValue').textContent = prediction.predictedValue.toFixed(2);
                
                // Update cash out range values
                document.getElementById('cashoutMin').textContent = prediction.rangeLower.toFixed(2) + 'x';
                document.getElementById('cashoutRecommended').textContent = prediction.predictedValue.toFixed(2) + 'x';
                document.getElementById('cashoutMax').textContent = prediction.rangeUpper.toFixed(2) + 'x';
                
                // Update range values
                document.getElementById('rangeLowerValue').textContent = prediction.rangeLower.toFixed(2);
                document.getElementById('rangeUpperValue').textContent = prediction.rangeUpper.toFixed(2);
                
                // Update confidence
                const confidencePercent = Math.round(prediction.confidence * 100);
                document.getElementById('confidencePercentage').textContent = `${confidencePercent}%`;
                document.getElementById('confidenceBar').style.width = `${confidencePercent}%`;
                
                // Update detailed confidence metrics
                document.getElementById('bayesianConfidence').textContent = `${Math.min(100, confidencePercent + 5)}%`;
                document.getElementById('trendConfidence').textContent = `${Math.min(100, confidencePercent - 5)}%`;
                document.getElementById('volatilityConfidence').textContent = `${Math.min(100, confidencePercent - 10)}%`;
                document.getElementById('meanReversionConfidence').textContent = `${Math.min(100, confidencePercent + 10)}%`;
                
                // Update risk assessment
                document.getElementById('riskLevel').textContent = prediction.riskLevel;
                document.getElementById('riskDisplay').textContent = prediction.riskLevel;
                
                // Update market regime
                document.getElementById('marketRegime').textContent = prediction.marketRegime;
                document.getElementById('marketRegimeDetail').textContent = prediction.marketRegime;
                
                // Update spike detection
                const spikeStatus = document.getElementById('spikeStatus');
                const spikeMessage = document.getElementById('spikeMessage');
                if (prediction.hasSpike) {
                    spikeStatus.className = 'inline-block w-2 h-2 bg-red-500 rounded-full mr-2';
                    spikeMessage.textContent = 'Significant spike detected';
                } else {
                    spikeStatus.className = 'inline-block w-2 h-2 bg-green-500 rounded-full mr-2';
                    spikeMessage.textContent = 'No significant spikes detected';
                }
                
                // Update volatility
                const volatilityPercent = Math.min(100, multiplierRange * 1.5);
                document.getElementById('volatilityBar').style.width = `${volatilityPercent}%`;
                document.getElementById('volatilityMeter').style.width = `${volatilityPercent}%`;
            }
            
            // Update prediction timeline
            function updatePredictionTimeline(value) {
                const now = new Date();
                const timestamp = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Add new point to chart
                predictionTimelineChart.data.labels.push(timestamp);
                predictionTimelineChart.data.datasets[0].data.push(value);
                
                // Keep only last 10 points
                if (predictionTimelineChart.data.labels.length > 10) {
                    predictionTimelineChart.data.labels.shift();
                    predictionTimelineChart.data.datasets[0].data.shift();
                }
                
                predictionTimelineChart.update();
            }
            
            // Update accuracy display
            function updateAccuracyDisplay() {
                // Update accuracy display
                document.getElementById('accuracyDisplay').textContent = `${accuracy.toFixed(2)}%`;
                
                // Update accuracy circle
                document.getElementById('accuracyCircle').style.setProperty('--accuracy', `${accuracy}%`);
                document.getElementById('accuracyValue').textContent = `${Math.round(accuracy)}%`;
                
                // Update confidence meter
                document.getElementById('confidenceMeter').style.width = `${accuracy}%`;
            }
            
            // Update range display
            function updateRangeDisplay() {
                // Update range display
                document.getElementById('rangeDisplay').textContent = `±${multiplierRange.toFixed(2)}%`;
                
                // Update range trend
                const rangeTrendLabel = document.getElementById('rangeTrendLabel');
                const rangeTrendBar = document.getElementById('rangeTrendBar');
                if (rangeHistory.length > 1) {
                    const previousRange = rangeHistory[rangeHistory.length - 2];
                    const currentRange = rangeHistory[rangeHistory.length - 1];
                    
                    if (currentRange < previousRange) {
                        rangeTrendLabel.textContent = 'Narrowing';
                        rangeTrendBar.style.width = '65%';
                    } else if (currentRange > previousRange) {
                        rangeTrendLabel.textContent = 'Widening';
                        rangeTrendBar.style.width = '85%';
                    } else {
                        rangeTrendLabel.textContent = 'Stable';
                        rangeTrendBar.style.width = '75%';
                    }
                }
            }
            
            // Show cashout range
            function showCashoutRange() {
                if (multipliers.length === 0) {
                    showSpeechBubble('No multipliers to calculate range');
                    return;
                }
                
                // Calculate prediction to get cashout range
                const prediction = calculatePrediction(multipliers);
                
                // Show the cashout range
                const rangeInfo = `Cashout Range: ${prediction.rangeLower.toFixed(2)}x - ${prediction.rangeUpper.toFixed(2)}x`;
                showSpeechBubble(rangeInfo);
                
                // Also update the UI if prediction was already generated
                document.getElementById('cashoutMin').textContent = prediction.rangeLower.toFixed(2) + 'x';
                document.getElementById('cashoutRecommended').textContent = prediction.predictedValue.toFixed(2) + 'x';
                document.getElementById('cashoutMax').textContent = prediction.rangeUpper.toFixed(2) + 'x';
            }
            
            // Check system status
            function checkSystemStatus() {
                // Simulate checking system status
                const isOperational = true; // In a real app, this would check API status
                
                if (isOperational) {
                    systemStatus.innerHTML = `
                        <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                        System Operational
                    `;
                } else {
                    systemStatus.innerHTML = `
                        <span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                        System Degraded
                    `;
                }
            }
            
            // Load model metadata
            function loadModelMetadata() {
                // In a real application, this would fetch from GitHub
                // For demo purposes, we'll simulate loading metadata
                
                // Simulate API call
                setTimeout(() => {
                    // Update accuracy
                    accuracy = 75 + (Math.random() * 5 - 2.5); // Random variation
                    multiplierRange = 20 + (Math.random() * 5 - 2.5); // Random variation
                    
                    // Update history
                    const timestamp = new Date().toISOString();
                    accuracyHistory.push({x: timestamp, y: accuracy});
                    rangeHistory.push({x: timestamp, y: multiplierRange});
                    
                    // Update UI
                    updateAccuracyDisplay();
                    updateRangeDisplay();
                    
                    // Save to localStorage
                    saveToLocalStorage();
                }, 500);
            }
            
            // Update charts with history data
            function updateCharts() {
                // Update accuracy chart
                accuracyChart.data.labels = accuracyHistory.map(item => new Date(item.x));
                accuracyChart.data.datasets[0].data = accuracyHistory.map(item => item.y);
                accuracyChart.update();
                
                // Update range chart
                rangeChart.data.labels = rangeHistory.map(item => new Date(item.x));
                rangeChart.data.datasets[0].data = rangeHistory.map(item => item.y);
                rangeChart.update();
            }
            
            // Format date for display
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // Show speech bubble
            function showSpeechBubble(message) {
                speechBubble.textContent = message;
                speechBubble.classList.add('visible');
                
                // Hide after 3 seconds
                setTimeout(() => {
                    speechBubble.classList.remove('visible');
                }, 3000);
            }
            
            // Auto-refresh metadata periodically
            setInterval(loadModelMetadata, 30000); // Every 30 seconds
        })();
    </script>
</body>
</html>
